<div class="dashboard">
    <h2>AIOPS Dashboard</h2>
    
    <!-- 统计卡片 - 固定位置 -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-value" data-type="total">{{ stats.total }}</div>
            <div class="stat-label">服务器总数</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" data-type="normal">{{ stats.normal }}</div>
            <div class="stat-label">正常状态</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" data-type="warning">{{ stats.warning }}</div>
            <div class="stat-label">异常状态</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" data-type="offline">{{ stats.offline }}</div>
            <div class="stat-label">离线状态</div>
        </div>
    </div>
    
    <!-- 服务器列表 - 可滚动区域 -->
    <div class="server-list-container">
        <table class="server-list">
            <thead>
                <tr>
                    <th style="width: 25%">服务器名称</th>
                    <th style="width: 25%">IP地址</th>
                    <th style="width: 30%">健康度</th>
                    <th style="width: 20%">状态</th>
                </tr>
            </thead>
            <tbody>
                {% for server in servers %}
                <tr>
                    <td>{{ server.name }}</td>
                    <td>{{ server.ip }}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="health-bar" style="flex-grow: 1;">
                                <div class="health-progress" style="width: {{ server.health }}%"></div>
                            </div>
                            <span>{{ server.health }}%</span>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span class="status-indicator status-{{ server.status }}"></span>
                            {% if server.status == 'normal' %}
                                正常
                            {% elif server.status == 'warning' %}
                                异常
                            {% else %}
                                离线
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function updateServerList() {
        fetch('/servers')
            .then(response => response.json())
            .then(data => {
                // 更新统计卡片
                document.querySelector('[data-type="total"]').innerText = data.stats.total;
                document.querySelector('[data-type="normal"]').innerText = data.stats.normal;
                document.querySelector('[data-type="warning"]').innerText = data.stats.warning;
                document.querySelector('[data-type="offline"]').innerText = data.stats.offline;

                // 更新服务器列表
                let tbody = document.querySelector('.server-list tbody');
                tbody.innerHTML = '';
                data.servers.forEach(server => {
                    let row = `
                        <tr>
                            <td>${server.name}</td>
                            <td>${server.ip}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="health-bar" style="flex-grow: 1;">
                                        <div class="health-progress" style="width: ${server.health}%"></div>
                                    </div>
                                    <span>${server.health}%</span>
                                </div>
                            </td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span class="status-indicator status-${server.status}"></span>
                                    ${server.status === 'normal' ? '正常' : server.status === 'warning' ? '异常' : '离线'}
                                </div>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            })
            .catch(err => console.error("更新服务器列表出错：", err));
    }
    setInterval(updateServerList, 5000);
</script>
