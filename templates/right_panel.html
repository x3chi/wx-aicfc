<div id="llm-output" style="white-space: pre-wrap; font-family: monospace; background: black; color: #FFFFFF; height: 100%; overflow: hidden;"></div>

<script>
  // 隐藏滚动条（这里用 overflow: hidden 已经隐藏滚动条）
  const outputDiv = document.getElementById("llm-output");

  // 定义一个函数，逐字符打印传入的文本，每个字符之间有一个延时
  function printChunkSlowly(chunk, delay = 50) {
    return new Promise(resolve => {
      let i = 0;
      function printNext() {
        if (i < chunk.length) {
          // 追加一个字符
          outputDiv.textContent += chunk[i];
          outputDiv.scrollTop = outputDiv.scrollHeight;
          i++;
          setTimeout(printNext, delay);
        } else {
          resolve();
        }
      }
      printNext();
    });
  }

  // 使用 Fetch API 获取 /stream 流式数据，并逐字符打印
  async function startStream() {
    try {
      const response = await fetch('/stream');
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      while (true) {
        const {done, value} = await reader.read();
        if (done) break;
        // 解码当前 chunk
        const chunk = decoder.decode(value);
        // 逐字符打印这个 chunk（await 确保本 chunk 打印完后再继续）
        await printChunkSlowly(chunk);
      }
    } catch (error) {
      console.error("Stream error:", error);
    }
  }

  startStream();
</script>
